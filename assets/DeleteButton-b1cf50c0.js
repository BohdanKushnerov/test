import{r as F,g as B,i as D,u as y,j as u,Q as w,f as d,n as b,e as m,D as q,E as L,P as z,S as I,q as H,H as K,G as W,h as G,l as Q}from"./index-cfb00355.js";import{s as M}from"./useResizeWindow-5917eeb9.js";import{m as X,r as J}from"./ChatPage-c08dbd11.js";var C={},V=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,r=[],n=0;n<t.rangeCount;n++)r.push(t.getRangeAt(n));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||r.forEach(function(o){t.addRange(o)}),e&&e.focus()}},Y=V,_={"text/plain":"Text","text/html":"Url",default:"Text"},Z="Copy to clipboard: #{key}, Enter";function U(t){var e=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C";return t.replace(/#{\s*key\s*}/g,e)}function ee(t,e){var r,n,o,a,i,s,l=!1;e||(e={}),r=e.debug||!1;try{o=Y(),a=document.createRange(),i=document.getSelection(),s=document.createElement("span"),s.textContent=t,s.ariaHidden="true",s.style.all="unset",s.style.position="fixed",s.style.top=0,s.style.clip="rect(0, 0, 0, 0)",s.style.whiteSpace="pre",s.style.webkitUserSelect="text",s.style.MozUserSelect="text",s.style.msUserSelect="text",s.style.userSelect="text",s.addEventListener("copy",function(c){if(c.stopPropagation(),e.format)if(c.preventDefault(),typeof c.clipboardData>"u"){r&&console.warn("unable to use e.clipboardData"),r&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var f=_[e.format]||_.default;window.clipboardData.setData(f,t)}else c.clipboardData.clearData(),c.clipboardData.setData(e.format,t);e.onCopy&&(c.preventDefault(),e.onCopy(c.clipboardData))}),document.body.appendChild(s),a.selectNodeContents(s),i.addRange(a);var p=document.execCommand("copy");if(!p)throw new Error("copy command was unsuccessful");l=!0}catch(c){r&&console.error("unable to copy using execCommand: ",c),r&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",t),e.onCopy&&e.onCopy(window.clipboardData),l=!0}catch(f){r&&console.error("unable to copy using clipboardData: ",f),r&&console.error("falling back to prompt"),n=U("message"in e?e.message:Z),window.prompt(n,t)}}finally{i&&(typeof i.removeRange=="function"?i.removeRange(a):i.removeAllRanges()),s&&document.body.removeChild(s),o()}return l}var te=ee;function O(t){"@babel/helpers - typeof";return O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(t)}Object.defineProperty(C,"__esModule",{value:!0});C.CopyToClipboard=void 0;var h=R(F),re=R(te),ne=["text","onCopy","options","children"];function R(t){return t&&t.__esModule?t:{default:t}}function S(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function E(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?S(Object(r),!0).forEach(function(n){P(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function oe(t,e){if(t==null)return{};var r=ae(t,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function ae(t,e){if(t==null)return{};var r={},n=Object.keys(t),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(r[o]=t[o]);return r}function se(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ie(t,e,r){return e&&T(t.prototype,e),r&&T(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function le(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}function x(t,e){return x=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},x(t,e)}function ce(t){var e=fe();return function(){var n=v(t),o;if(e){var a=v(this).constructor;o=Reflect.construct(n,arguments,a)}else o=n.apply(this,arguments);return ue(this,o)}}function ue(t,e){if(e&&(O(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return k(t)}function k(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function fe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},v(t)}function P(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var N=function(t){le(r,t);var e=ce(r);function r(){var n;se(this,r);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=e.call.apply(e,[this].concat(a)),P(k(n),"onClick",function(s){var l=n.props,p=l.text,c=l.onCopy,f=l.children,$=l.options,g=h.default.Children.only(f),A=(0,re.default)(p,$);c&&c(p,A),g&&g.props&&typeof g.props.onClick=="function"&&g.props.onClick(s)}),n}return ie(r,[{key:"render",value:function(){var o=this.props;o.text,o.onCopy,o.options;var a=o.children,i=oe(o,ne),s=h.default.Children.only(a);return h.default.cloneElement(s,E(E({},i),{},{onClick:this.onClick}))}}]),r}(h.default.PureComponent);C.CopyToClipboard=N;P(N,"defaultProps",{onCopy:void 0,options:void 0});var pe=C,j=pe.CopyToClipboard;j.CopyToClipboard=j;var de=j;const ye=B(de);function me(t){if(t!=null&&t.length)return t.map(e=>e.data().message).join(" ")}const Oe=({textContent:t=!0,white:e="white",dark:r="white"})=>{const{t:n}=D(),o=y(s=>s.selectedDocDataMessage),a=y(s=>s.resetSelectedMessages),i=()=>{w.success(n("Toasts.CopyToClipboard")),a(),document.getElementById("chatFormInput").focus()};return u.jsx(u.Fragment,{children:o&&u.jsx(ye,{text:me(o)||"",onCopy:i,children:u.jsxs("div",{className:`flex items-center ${t?"justify-between":"justify-center"}  w-full px-8 py-2 text-white transition-all duration-150 hover:cursor-pointer hover:bg-zinc-600/90 hover:rounded-md`,children:[u.jsx("svg",{width:20,height:20,className:`flex fill-${e} dark:fill-${r}`,children:u.jsx("use",{href:M+"#icon-copy"})}),t&&u.jsx("span",{className:"text-base",children:n("ContextMenu.Copy")})]})})})},ge=async(t,e,r)=>{await Promise.all(t.map(async n=>{var a;const o=(a=n.data())==null?void 0:a.file;if(o){const i=o.map(s=>{const l=q(L,s.url);return z(l)});await Promise.all(i)}await I(m(e,"chats",r,"messages",n.id))}))},be=async(t,e)=>{const r=H(G(e,`chats/${t}/messages`),W("date","desc"),K(1)),n=await Q(r);if(n.empty)return console.log("No messages"),null;const a=n.docs[0].data();return console.log("Last message:",a),a},he=async(t,e,r,n,o,a)=>{if(e&&t!==null&&r&&n&&t)try{X(),await ge(t,d,e).then(()=>{a()});const i=await be(e,d);if(i){const l=i.file,p=l?`${String.fromCodePoint(128206)} ${l.length} file(s) ${i.message}`:i.message,c=i.senderUserID,f=i.date;await b(m(d,"userChats",r),{[e+".lastMessage"]:p,[e+".senderUserID"]:c,[e+".date"]:f}),await b(m(d,"userChats",n),{[e+".lastMessage"]:p,[e+".senderUserID"]:c,[e+".date"]:f})}else await b(m(d,"userChats",r),{[e+".lastMessage"]:" ",[e+".senderUserID"]:" ",[e+".date"]:" "}),await b(m(d,"userChats",n),{[e+".lastMessage"]:" ",[e+".senderUserID"]:" ",[e+".date"]:" "});document.getElementById("chatFormInput").focus(),w.success(o("Toasts.DeleteMessageSuccess"))}catch(i){w.error(o("Toasts.DeleteMessageError")),console.log("handleDeleteMessage error",i)}finally{J()}},xe=({textContent:t=!0,color:e})=>{const{t:r}=D(),n=y(l=>l.currentUser.uid),{chatUID:o,userUID:a}=y(l=>l.currentChatInfo),i=y(l=>l.selectedDocDataMessage),s=y(l=>l.resetSelectedMessages);return u.jsxs("button",{className:"flex items-center justify-between w-full px-8 py-2 text-white transition-all duration-150 hover:cursor-pointer hover:bg-zinc-600/90 hover:rounded-md",onClick:()=>he(i,o,n,a,r,s),"aria-label":"Delete message",children:[u.jsx("svg",{width:20,height:20,children:u.jsx("use",{href:M+"#icon-delete-button",fill:e})}),t&&u.jsx("span",{className:"text-base",children:r("ContextMenu.Delete")})]})};export{Oe as C,xe as D};
