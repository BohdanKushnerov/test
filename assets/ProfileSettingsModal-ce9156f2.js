import{b as x,C as w,D as b,S as U,E as P,M as S,c as v,n as L,e as B,f as N,Q as y,r as R,i as T,u as k,j as e}from"./index-b48e6dac.js";import{L as M}from"./Line-dd9c0f3b.js";import{M as E}from"./ModalWindow-37df0ac3.js";import $ from"./ButtonClose-7ab1b53f.js";import{v as z}from"./v4-4a60fe23.js";import"./useResizeWindow-f5ffb2a2.js";import"./useCloseModal-266f730d.js";const F=async(a,s,o,d,l,m,f)=>{var h;if((h=a.current)!=null&&h.files&&x.currentUser&&s){const t=a.current.files[0];if(t)try{const n={contentType:t.type},u=w(b,`${t.type}/${s}/${z()}-${t.name}`),c=new Blob([t]),p=U(u,c,n),g=await new Promise((i,j)=>{p.on("state_changed",r=>{const C=r.bytesTransferred/r.totalBytes*100;o(C)},r=>{console.log("uploadTask.on error",r)},async()=>{try{const r=await P(p.snapshot.ref);i(r)}catch(r){j(r)}})});if(l){const i=w(b,l);await S(i)}await v(x.currentUser,{photoURL:g}).then(()=>{m(x.currentUser)}).catch(i=>{console.log("handleUpdateProfilePhoto error",i)}),await L(B(N,"users",s),{photoURL:g}),f(),o(null),y.success(d("ChangePhotoToastSuccess"))}catch(n){y.error(d("ChangePhotoToastError")),console.log("handleUpdateProfilePhoto error",n)}}},G=({photoProfileInputRef:a,handleToggleProfilePhotoModal:s})=>{var t,n,u;const[o,d]=R.useState(null),{t:l}=T("translation",{keyPrefix:"ProfileSettings"}),{uid:m,photoURL:f}=k(c=>c.currentUser),h=k(c=>c.updateCurrentUser);return e.jsx(E,{handleToggleModal:s,children:e.jsx("div",{className:"h-full flex justify-center items-center",children:e.jsxs("div",{className:"relative w-full sm:w-1/2 xl:w-1/3 h-2/3 flex flex-col gap-6 justify-center items-center bg-gray-200 dark:bg-myBlackBcg rounded-3xl shadow-mainShadow",children:[e.jsx($,{handleClickButtonClose:s}),((t=a.current)==null?void 0:t.files)&&e.jsx("img",{className:"rounded-full max-h-[200px] max-w-[200px]",src:URL.createObjectURL((n=a.current)==null?void 0:n.files[0]),alt:(u=a.current)==null?void 0:u.files[0].name,width:200,height:200}),e.jsx("p",{className:"w-80 text-center text-black dark:text-white text-xs",children:l("Modal.ChangeProfilePhotoPrompt")}),e.jsx("button",{className:"w-48 border-2 rounded-3xl text-black dark:text-white border-black dark:border-white transition-all duration-300 hover:shadow-mainShadow hover:bg-zinc-400 hover:dark:bg-gray-800 disabled:text-zinc-600",onClick:()=>F(a,m,d,l,f,h,s),"aria-label":"Update profile photo",disabled:typeof o=="number",children:l("Modal.ChangeProfilePhoto")}),e.jsx("div",{className:"flex gap-4 items-center h-4",children:typeof o=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-black dark:text-white",children:"Loading:"}),e.jsx(M,{style:{width:150},percent:o,strokeWidth:6,strokeColor:"#5ee987",trailColor:"#5f5f5f"})]})})]})})})};export{G as default};
