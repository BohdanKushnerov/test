import{j as s,u as h,r as c,q as O,w,h as $,f as g,o as P,i as j,k as V,L as B,b as v,e as p,_,l as W,m as k,d as H,n as R,p as D,t as q,v as Q,x as T,y as G,z as J,O as I}from"./index-cfb00355.js";import{u as K,s as L,a as X,b as Y,A,o as Z,T as M,c as ee}from"./useResizeWindow-5917eeb9.js";import{L as b}from"./LoaderUIActions-a782f21d.js";import{S as se}from"./SearchMsgsInput-8343bb00.js";function te(e,t){if(e)return e.length<=t?e:e.substring(0,t)+"..."}const ae=({chatUID:e,chatInfo:t,userInfo:a})=>s.jsxs("div",{className:"w-full",children:[s.jsx("p",{className:`font-bold ${e===t[0]?"text-white":"text-zinc-900 dark:text-white"}`,children:a==null?void 0:a.displayName}),s.jsx("p",{className:`${e===t[0]?"text-white":"text-zinc-600 dark:text-zinc-100"}`,children:te(t[1].lastMessage,25)})]}),re=(e,t)=>{const a=h(r=>r.updateTotalUnreadMessages);c.useEffect(()=>{t[0]&&a(e?{[t[0]]:e}:{[t[0]]:0})},[t,e,a])},ne=({chatInfo:e})=>{const t=K(e);return re(t,e),s.jsx(s.Fragment,{children:t>0&&s.jsx("p",{className:"flex justify-center items-center p-1 px-3 border border-white text-white rounded-full shadow-mainShadow bg-gray-500",children:t})})},ie=e=>{const[t,a]=c.useState(!0),{uid:r}=h(n=>n.currentUser);return c.useEffect(()=>{if(!e[0]||!r)return;const n=O($(g,`chats/${e[0]}/messages`),w("isRead","==",!1),w("senderUserID","==",r)),i=P(n,o=>{o.docs.length>0?a(!1):a(!0)});return()=>{i()}},[e,r]),t},ce=({chatInfo:e})=>{const{chatUID:t}=h(n=>n.currentChatInfo),{uid:a}=h(n=>n.currentUser),r=ie(e);return s.jsx(s.Fragment,{children:e[1].senderUserID===a&&(r?s.jsx("svg",{width:48,height:48,className:`${t===e[0]?"fill-white":"fill-zinc-800 dark:fill-white"}`,children:s.jsx("use",{href:L+"#icon-double-check",className:"shadow-avatarShadow"})}):s.jsx("svg",{width:48,height:48,className:`${t===e[0]?"fill-white":"fill-zinc-800 dark:fill-white"} drop-shadow-2xl`,children:s.jsx("use",{href:L+"#icon-single-check",className:"drop-shadow-2xl"})}))})},le=({chatInfo:e})=>{const{t}=j(),a=X(e[1].userUID);return s.jsx("div",{className:`${a?"text-green-700":"text-red-700"}`,children:t(a?"Online":"Offline")})},z=(e,t)=>{t(e)},oe=({chatInfo:e})=>{const t=V(),{chatUID:a}=h(o=>o.currentChatInfo),r=h(o=>o.updateCurrentChatInfo),n=Y(e[1].userUID);console.log("screen --> ChatListItem");const i=()=>{e[0]&&z(e,r)};return s.jsx("li",{className:"block w-full border border-inputChar border-l-transparent border-r-transparent p-2",onClick:i,children:s.jsxs(B,{className:`flex items-center content-center gap-3 h-[72px] p-1 rounded-md transition-all duration-300 group ${a===e[0]&&"bg-zinc-700 hover:bg-zinc-600 dark:bg-cyan-600 hover:dark:bg-cyan-700"} ${a!==e[0]&&"hover:bg-zinc-400 hover:dark:bg-zinc-700"} `,to:`/${e[0]}`,state:{from:t},children:[s.jsx(A,{photoURL:n==null?void 0:n.photoURL,displayName:n==null?void 0:n.displayName,size:"50"}),s.jsx(ae,{chatUID:a,chatInfo:e,userInfo:n}),s.jsx(ne,{chatInfo:e}),s.jsx(ce,{chatInfo:e}),s.jsx(le,{chatInfo:e})]})})},de=()=>{const[e,t]=c.useState(!1),[a,r]=c.useState(null);return c.useEffect(()=>{var i,o,l,f;if(!((o=(i=v)==null?void 0:i.currentUser)!=null&&o.uid))return;t(!0);const n=P(p(g,"userChats",(f=(l=v)==null?void 0:l.currentUser)==null?void 0:f.uid),d=>{const u=d.data();let x=!0;for(const m in u)if(Object.prototype.hasOwnProperty.call(u,m)&&!u[m].date){x=!1;break}if(x&&u){const m=Object.entries(u).sort((C,y)=>y[1].date-C[1].date);r(m),t(!1)}});return()=>{n()}},[]),{isLoading:e,myUserChatList:a}},ue=()=>{const{t:e}=j("translation",{keyPrefix:"Sidebar"}),{isLoading:t,myUserChatList:a}=de();return console.log("screen --> ChatList"),s.jsxs("div",{children:[t&&s.jsx("div",{className:"flex justify-center",children:s.jsx(b,{size:100})}),!t&&a&&a.length>0?s.jsx("ul",{className:"h-full p-0 m-0",children:a&&a.map(r=>s.jsx(oe,{chatInfo:r},r[0]))}):s.jsx(s.Fragment,{children:!t&&s.jsx("div",{children:s.jsx("p",{className:"text-center font-black text-black dark:text-white",children:e("NoChats")})})})]})},he=c.lazy(()=>_(()=>import("./NavbarModal-65664ca1.js"),["assets/NavbarModal-65664ca1.js","assets/index-cfb00355.js","assets/index-39592672.css","assets/ModalWindow-b977f238.js","assets/useCloseModal-c43e9243.js","assets/useResizeWindow-5917eeb9.js","assets/useStartTransition-527b6240.js"])),fe=()=>{const[e,t]=c.useState(!1),a=()=>{t(r=>!r)};return s.jsxs("div",{children:[s.jsx("div",{className:"relative w-12 h-10 flex justify-center items-center bg-transparent transition-all duration-300 hover:bg-zinc-400 hover:dark:bg-zinc-100/10 rounded-full cursor-pointer",onClick:a,children:s.jsx("svg",{width:32,height:32,className:"fill-zinc-800 dark:fill-zinc-400",children:s.jsx("use",{href:L+"#icon-menu"})})}),s.jsx(c.Suspense,{fallback:s.jsx("div",{className:"absolute top-2 left-4",children:s.jsx(b,{size:40})}),children:e&&s.jsx(he,{handleToggleModal:a})})]})},xe=()=>{const{t:e}=j(),t=h(n=>n.searchValue),a=h(n=>n.updateSearchValue),r=n=>{a(n.target.value)};return s.jsx(se,{value:t,handleChange:r,placeholderText:e("Search")})};function me(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ge(e){return e.split(" ").map(r=>me(r)).join(" ")}const pe=()=>{const[e,t]=c.useState(!1),[a,r]=c.useState(null),n=h(o=>o.searchValue),[i]=Z(n,300);return c.useEffect(()=>{if(i.trim()===""){r(null);return}return(async()=>{t(!0);const l=ge(i).trim(),f=$(g,"users"),d=O(f,w("displayName",">=",l),w("displayName","<=",l+"ï£¿"));try{const u=await W(d);r(u)}catch(u){console.error("Error fetching data:",u)}finally{t(!1)}})(),()=>{r(null)}},[i]),{searchChatList:a,setSearchChatList:r,isLoading:e}},be=async(e,t,a)=>{var o,l,f,d,u,x,m,C;if(!((l=(o=v)==null?void 0:o.currentUser)!=null&&l.uid))return;const r=(d=(f=v)==null?void 0:f.currentUser)==null?void 0:d.uid,n=e.uid,i=r&&r>n?r+n:n+r;try{(await k(p(g,"chats",i))).exists()||(await H(p(g,"chats",i),{}),await R(p(g,"userChats",r),{[i+".userUID"]:e.uid,[i+".date"]:D()}),await R(p(g,"userChats",n),{[i+".userUID"]:(u=v)==null?void 0:u.currentUser.uid,[i+".date"]:D()}));const S=await k(p(g,"userChats",r)),F=[i,{lastMessage:(x=S.data())==null?void 0:x[i].lastMessage,senderUserID:(m=S.data())==null?void 0:m[i].senderUserID,userUID:(C=S.data())==null?void 0:C[i].userUID}];z(F,t),a(i)}catch(y){console.log("error handleCreateChat",y)}},je=()=>{const e=q(),{t}=j("translation",{keyPrefix:"Sidebar"}),a=h(d=>d.updateSearchValue),r=h(d=>d.currentUser),n=h(d=>d.updateCurrentChatInfo),{searchChatList:i,setSearchChatList:o,isLoading:l}=pe(),f=d=>{be(d,n,e),o(null),a("")};return s.jsxs("div",{className:"px-2",children:[l&&s.jsx(b,{size:50}),!l&&i&&i.size>0?s.jsx("ul",{children:i.docs.map(d=>{if(d.data().uid===r.uid)return null;const u=d.data();return s.jsxs("li",{className:"flex items-center content-center gap-3 h-[72px] p-2 transition-all duration-300 group hover:bg-zinc-400 rounded-md hover:cursor-pointer",onClick:()=>f(u),children:[s.jsx(A,{photoURL:u.photoURL,displayName:u.displayName,size:"50"}),s.jsx("p",{className:"text-zinc-600 dark:text-zinc-400 font-semibold",children:u.displayName})]},d.id)})}):s.jsx(s.Fragment,{children:!l&&i&&s.jsx("div",{children:s.jsx("p",{className:"text-black dark:text-white font-black",children:t("UsersNotFound")})})})]})},Ce=c.lazy(()=>_(()=>import("./ProfileSettings-db451165.js"),["assets/ProfileSettings-db451165.js","assets/index-cfb00355.js","assets/index-39592672.css","assets/ButtonArrow-2aa489d1.js","assets/useResizeWindow-5917eeb9.js","assets/useStartTransition-527b6240.js","assets/LoaderUIActions-a782f21d.js"])),E=()=>{const e=c.useRef(null),t=h(a=>a.sidebarScreen);return console.log("screen --> Sidebar"),s.jsxs("div",{className:"relative w-full h-full bg-gray-200 dark:bg-myBlackBcg sm:min-w-[400px] sm:w-1/4 border-r border-r-zinc-800",children:[s.jsx(M,{nodeRef:e,in:t==="default",timeout:300,unmountOnExit:!0,children:a=>s.jsxs("div",{ref:e,className:`w-full h-full transform origin-top-left transition-transform 
                  ${a==="exited"?"hidden":""}
                  ${a==="entered"?"rotate-0 translate-x-0":"rotate-180 -translate-x-1/2 duration-300"}
                  `,children:[s.jsxs("div",{className:"flex gap-2 px-3 py-2",children:[s.jsx(fe,{}),s.jsx(xe,{})]}),s.jsxs("div",{style:{position:"relative",overflow:"scroll",width:"100%",height:"calc(100% - 48px)"},children:[s.jsx(je,{}),s.jsx(ue,{})]})]})}),t==="profileSettings"&&s.jsx(c.Suspense,{fallback:s.jsx("div",{className:"absolute left-1/2 -translate-x-1/2",children:s.jsx(b,{size:200})}),children:s.jsx(Ce,{})})]})};function U(e){const t=document.querySelector("link[rel='icon']")||document.createElement("link"),a=t;a.type="image/ico",a.rel="icon",a.href=e,document.head.appendChild(t)}const N="/react-web-messenger/assets/faviconTab-e4043aa9.ico",ve="/react-web-messenger/assets/faviconMessageTab-9ae18f2b.ico",ye=(e,t)=>{const a=c.useRef(null),{t:r}=j("translation",{keyPrefix:"ChatListUnreadMsg"});c.useEffect(()=>{const n="React Web Messenger";return(()=>{if(t){if(e){const o=()=>{document.title===n?(document.title=e===1?`(${e}) ${r("UnreadMessage")}`:`(${e}) ${r("UnreadMessages")}`,U(ve)):(document.title=n,U(N))};a.current&&(clearInterval(a.current),a.current=null),a.current=setInterval(o,2e3)}}else U(N),a.current&&(clearInterval(a.current),a.current=null),document.title=n})(),()=>{a.current&&(clearInterval(a.current),a.current=null),U(N),document.title=n}},[e,t,r])},Ue=e=>{const[t,a]=c.useState(0);return c.useEffect(()=>{const r=Object.values(e).reduce((n,i)=>n+=i,0);r!==t&&a(r)},[e,t]),t!==0?t:null},we=({docHidden:e})=>{const t=h(r=>r.totalUnreadMessages),a=Ue(t);return ye(a,e),null},Se=()=>{c.useEffect(()=>{(async()=>{try{const t=await Notification.requestPermission()}catch(t){console.error("Failed to request notification permission:",t)}})()},[])},Ne=()=>{const e=q(),t=h(r=>r.currentUser.uid),a=h(r=>r.updateCurrentChatInfo);c.useEffect(()=>{async function r(n,i,o){var f,d,u;const l=localStorage.getItem("currentChatId");if(l&&n){const x=await k(p(g,"userChats",n)),m=[l,{lastMessage:(f=x.data())==null?void 0:f[l].lastMessage,senderUserID:(d=x.data())==null?void 0:d[l].senderUserID,userUID:(u=x.data())==null?void 0:u[l].userUID}];i(m,o),e(l)}}r(t,z,a)},[t,e,a])},ke=()=>{const e=h(t=>t.currentUser.uid);c.useEffect(()=>{if(e){const t=Q(J,"status/"+e);T(t,!0);const a=G(t);return a.set(!1),()=>{a.cancel(),T(t,!1)}}},[e])},Le=()=>{const[e,t]=c.useState(!1);return c.useEffect(()=>{const a=()=>{document.hidden?t(!0):t(!1)};return document.addEventListener("visibilitychange",a),()=>{document.removeEventListener("visibilitychange",a)}},[]),e},Me="/react-web-messenger/assets/notify-d07c9a9b.mp3",Ie=c.memo(()=>{const{pathname:e}=V(),t=c.useRef(null),a=c.useRef(null),{t:r}=j(),{isFullScreen:n,heightWindow:i}=ee(),o=Le();return Se(),ke(),Ne(),console.log("screen --> HomePage"),s.jsxs("div",{className:"flex overflow-hidden bg-main-bcg2 bg-no-repeat bg-cover bg-center",style:{height:`${i}px`},children:[s.jsxs("div",{className:"w-full h-full flex sm:hidden",children:[s.jsx(M,{nodeRef:t,in:window.innerWidth<=639?(e==="/"?"Sidebar":"Chat")=="Sidebar":!1,timeout:300,unmountOnExit:!0,children:l=>s.jsx("div",{ref:t,className:`w-full ${l==="exited"?"hidden":""} transform transition-transform ${l==="entered"?"translate-x-0 scale-100":"-translate-x-full scale-0"}`,children:s.jsx(E,{})})}),s.jsx(M,{nodeRef:a,in:window.innerWidth<=639?(e==="/"?"Sidebar":"Chat")=="Chat":!1,timeout:300,unmountOnExit:!0,children:l=>s.jsx("div",{ref:a,className:`w-full transform transition-transform 
                  ${l==="exited"?"hidden":""}
                  ${l==="entered"?"translate-x-0 scale-100":"translate-x-full scale-0"}`,children:s.jsx(c.Suspense,{fallback:s.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:s.jsx(b,{size:200})}),children:s.jsx(I,{})})})})]}),n&&s.jsxs("div",{className:"hidden sm:flex overflow-hidden",style:{height:`${i}px`},children:[s.jsx(E,{}),e==="/"&&s.jsx("div",{className:"relative h-full w-screen xl:flex xl:flex-col xl:items-center bg-transparent overflow-hidden",children:s.jsx("h2",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-4 bg-gray-700 rounded-xl text-center text-white font-black",children:r("EmptyChatNofify")})}),s.jsx(c.Suspense,{fallback:s.jsx("div",{className:"absolute top-1/2 left-1/2 translate-x-1/2 -translate-y-1/2",children:s.jsx(b,{size:200})}),children:s.jsx(I,{})})]}),o&&s.jsx(we,{docHidden:o}),s.jsx("audio",{src:Me,id:"notify"})]})});export{Ie as default};
