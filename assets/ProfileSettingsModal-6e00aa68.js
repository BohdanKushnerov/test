import{b as x,D as b,E as g,U as C,F as P,P as v,c as L,n as S,e as B,f as N,Q as j,r as R,i as T,u as y,j as e}from"./index-cfb00355.js";import{L as E}from"./Line-bdebc499.js";import{M}from"./ModalWindow-b977f238.js";import $ from"./ButtonClose-0cdfd75f.js";import{v as F}from"./v4-4a60fe23.js";import"./useResizeWindow-5917eeb9.js";import"./useCloseModal-c43e9243.js";const z=async(a,s,o,d,l,f,m)=>{var h;if((h=a.current)!=null&&h.files&&x.currentUser&&s){const t=a.current.files[0];if(t)try{const n={contentType:t.type},u=b(g,`${t.type}/${s}/${F()}-${t.name}`),c=new Blob([t]),p=C(u,c,n),w=await new Promise((i,k)=>{p.on("state_changed",r=>{const U=r.bytesTransferred/r.totalBytes*100;o(U)},r=>{console.log("uploadTask.on error",r)},async()=>{try{const r=await P(p.snapshot.ref);i(r)}catch(r){k(r)}})});if(l){const i=b(g,l);await v(i)}await L(x.currentUser,{photoURL:w}).then(()=>{f(x.currentUser)}).catch(i=>{console.log("handleUpdateProfilePhoto error",i)}),await S(B(N,"users",s),{photoURL:w}),m(),o(null),j.success(d("ChangePhotoToastSuccess"))}catch(n){j.error(d("ChangePhotoToastError")),console.log("handleUpdateProfilePhoto error",n)}}},G=({photoProfileInputRef:a,handleToggleProfilePhotoModal:s})=>{var t,n,u;const[o,d]=R.useState(null),{t:l}=T("translation",{keyPrefix:"ProfileSettings"}),{uid:f,photoURL:m}=y(c=>c.currentUser),h=y(c=>c.updateCurrentUser);return e.jsx(M,{handleToggleModal:s,children:e.jsx("div",{className:"h-full flex justify-center items-center",children:e.jsxs("div",{className:"relative w-full sm:w-1/2 xl:w-1/3 h-2/3 flex flex-col gap-6 justify-center items-center bg-gray-200 dark:bg-myBlackBcg rounded-3xl shadow-mainShadow",children:[e.jsx($,{handleClickButtonClose:s}),((t=a.current)==null?void 0:t.files)&&e.jsx("div",{className:"w-[200px] h-[200px]",children:e.jsx("img",{className:"rounded-full w-full h-full object-cover",src:URL.createObjectURL((n=a.current)==null?void 0:n.files[0]),alt:(u=a.current)==null?void 0:u.files[0].name,width:200,height:200})}),e.jsx("p",{className:"w-80 text-center text-black dark:text-white text-xs",children:l("Modal.ChangeProfilePhotoPrompt")}),e.jsx("button",{className:"w-48 border-2 rounded-3xl text-black dark:text-white border-black dark:border-white transition-all duration-300 hover:shadow-mainShadow hover:bg-zinc-400 hover:dark:bg-gray-800 disabled:text-zinc-600",onClick:()=>z(a,f,d,l,m,h,s),"aria-label":"Update profile photo",disabled:typeof o=="number",children:l("Modal.ChangeProfilePhoto")}),e.jsx("div",{className:"flex gap-4 items-center h-4",children:typeof o=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-black dark:text-white",children:"Loading:"}),e.jsx(E,{style:{width:150},percent:o,strokeWidth:6,strokeColor:"#5ee987",trailColor:"#5f5f5f"})]})})]})})})};export{G as default};
