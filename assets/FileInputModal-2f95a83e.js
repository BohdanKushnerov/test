import{j as e,r as w,i as E,u as $,C as W,D as K,S as _,E as q,A as G,h as H,f as y,T as J,n as R,e as B,p as F}from"./index-b48e6dac.js";import{M as Q}from"./ModalWindow-37df0ac3.js";import V from"./ButtonClose-7ab1b53f.js";import{L}from"./Line-dd9c0f3b.js";import{F as X,d as Y}from"./ChatPage-9d9a933c.js";import{v as Z}from"./v4-4a60fe23.js";import"./useCloseModal-266f730d.js";import"./useResizeWindow-f5ffb2a2.js";import"./LoaderUIActions-96cbd80d.js";const ee=({file:t,status:n})=>e.jsxs("li",{className:"flex justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:URL.createObjectURL(t),alt:`Image ${t.name}`,width:48,height:48}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-black dark:text-white w-24 2xl:w-64",children:t.name}),e.jsx("p",{className:"text-gray-500",children:(t.size/1024).toFixed(2)+" KB"})]})]}),n>=0&&e.jsx(L,{style:{width:150},percent:n,strokeWidth:6,strokeColor:"#5ee987"})]},t.name),se=({fileType:t,file:n,status:d})=>e.jsxs("li",{className:"flex justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"w-12",children:e.jsx(X,{extension:t,...Y[t]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-white w-24 2xl:w-64",children:n.name}),e.jsx("p",{className:"text-gray-500",children:(n.size/1024).toFixed(2)+" KB"})]})]}),d>=0&&e.jsx(L,{style:{width:150},percent:d,strokeWidth:6,strokeColor:"#5ee987"})]},n.name),me=({hiddenFileInput:t,setIsModalAddFileOpen:n,handleToggleModal:d})=>{var N,k,S;const[o,j]=w.useState(""),[h,b]=w.useState({}),M=w.useRef(null),{t:m}=E("translation",{keyPrefix:"FileInput"}),c=$(s=>s.currentUser.uid),{chatUID:l,userUID:x}=$(s=>s.currentChatInfo),v=()=>{n(!1),o&&j(""),t.current&&(t.current.value="")},I=async s=>{var p;if(s.preventDefault(),(p=t.current)!=null&&p.files&&c){try{const u=Array.from(t.current.files).map(async a=>{const T={contentType:a.type},A=W(K,`${a.type}/${x}/${Z()}-${a.name}`),U=new Blob([a]),C=_(A,U,T);return new Promise((D,z)=>{C.on("state_changed",r=>{const i=r.bytesTransferred/r.totalBytes*100;b(f=>({...f,[a.name]:i}))},r=>{console.log("error",r)},async()=>{try{const r=await q(C.snapshot.ref);if(a.type==="image/png"||a.type==="image/jpeg"||a.type==="image/webp"){const i=new Image;i.src=URL.createObjectURL(U),i.onload=()=>{const f=i.width,O=i.height;D({type:a.type,name:a.name,url:r,width:f,height:O})}}else D({type:a.type,name:a.name,url:r})}catch(r){z(r)}})})}),g=await Promise.all(u);await G(H(y,`chats/${l}/messages`),{file:g,message:o||"",senderUserID:c,date:J.now(),isRead:!1}),c&&x&&(await R(B(y,"userChats",c),{[l+".lastMessage"]:`${String.fromCodePoint(128206)} ${g.length} file(s) ${o}`,[l+".senderUserID"]:c,[l+".date"]:F()}),await R(B(y,"userChats",x),{[l+".lastMessage"]:`${String.fromCodePoint(128206)} ${g.length} file(s) ${o}`,[l+".senderUserID"]:c,[l+".date"]:F()}))}catch(u){console.error("error handleManageSendFile",u)}b({}),v()}},P=s=>{j(s.target.value)};return e.jsx(Q,{handleToggleModal:d,children:e.jsx("div",{className:"h-full flex justify-center items-center",children:e.jsxs("div",{className:"relative w-full sm:w-1/2 xl:w-1/3 h-1/2 flex flex-col gap-8 justify-between items-center p-2 bg-gray-200 dark:bg-myBlackBcg rounded-3xl shadow-mainShadow",children:[e.jsx("p",{className:"text-black dark:text-white font-extrabold",children:`${m("Send")} ${(k=(N=t.current)==null?void 0:N.files)==null?void 0:k.length} ${m("Files")}`}),e.jsx(V,{handleClickButtonClose:v}),e.jsx("div",{ref:M,className:"w-full h-full overflow-scroll",children:e.jsx("ul",{className:"flex flex-col gap-2",children:((S=t.current)==null?void 0:S.files)&&Array.from(t.current.files).map(s=>{if(s.type==="image/jpeg"||s.type==="image/png"||s.type==="image/webp")return e.jsx(ee,{status:h[s.name],file:s},s.name);{const p=s.name.split(".").pop()||"default";return e.jsx(se,{file:s,fileType:p,status:h[s.name]},s.name)}})})}),e.jsxs("form",{className:"w-full flex items-center gap-4 h-8 px-6",onSubmit:I,children:[e.jsx("div",{className:"relative w-full h-10 sm:w-8/12 ",children:e.jsx("input",{className:"w-full h-full py-1 px-10 rounded-3xl bg-zinc-500 dark:bg-mySeacrhBcg text-white outline-none border-2 border-transparent focus:border-cyan-500",type:"text",placeholder:m("ImageCaptionPlaceholder"),value:o,onChange:P})}),e.jsx("button",{className:"px-2 py-1 border border-gray-600 rounded-full text-black dark:text-white transition-all duration-300 hover:shadow-mainShadow hover:bg-zinc-400 hover:dark:bg-gray-800",type:"submit",disabled:Object.keys(h).length>0,"aria-label":"Send",children:m("Send")})]})]})})})};export{me as default};
